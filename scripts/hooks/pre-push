#!/bin/bash
# Pre-push hook - run tests before pushing to remote
#
# This hook prevents broken code from being pushed to the remote repository.
# It runs the full test suite and aborts the push if tests fail.
#
# Installation:
#   cp scripts/hooks/pre-push .git/hooks/
#   chmod +x .git/hooks/pre-push
#
# To bypass this check (NOT RECOMMENDED):
#   git push --no-verify

echo "Running pre-push checks..."
echo ""

# Run comprehensive validation (build + compile tests + run all tests)
make check

if [ $? -ne 0 ]; then
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "ERROR: Tests failed. Push aborted."
    echo ""
    echo "Please fix the failing tests before pushing."
    echo ""
    echo "To bypass this check (NOT RECOMMENDED):"
    echo "  git push --no-verify"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    exit 1
fi

echo ""
echo "✓ All checks passed. Proceeding with push."
exit 0
